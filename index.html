<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foglalkoztat√°si Forma Kalkul√°tor 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #F2EFE9;
    --bg2: #E8E3DA;
    --ink: #1A1714;
    --ink2: #4A4540;
    --ink3: #8A8178;
    --accent: #C4521A;
    --accent2: #2B6CB0;
    --accent3: #276749;
    --card: #FDFCFA;
    --border: #D4CEC5;
    --shadow: rgba(26,23,20,0.08);
  }

  body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--ink); min-height: 100vh; }

  header {
    background: var(--card);
    border-bottom: 2px solid var(--border);
    padding: 40px 48px 32px; position: relative; overflow: hidden;
    text-align: center;
  }
  header::before {
    content: ''; position: absolute; right: -60px; top: -60px;
    width: 320px; height: 320px; border-radius: 50%; background: var(--accent); opacity: 0.06;
  }
  header::after {
    content: ''; position: absolute; left: -30px; bottom: -80px;
    width: 200px; height: 200px; border-radius: 50%; background: var(--accent2); opacity: 0.05;
  }
  .header-badge {
    display: inline-block; font-family: 'Fira Code', monospace;
    font-size: 11px; letter-spacing: 2px; text-transform: uppercase;
    color: var(--accent); border: 1px solid var(--accent);
    padding: 4px 12px; border-radius: 20px; margin-bottom: 18px;
  }
  header h1 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: clamp(24px, 5vw, 44px); font-weight: 800; line-height: 1.15; position: relative; color: var(--ink); }
  header p { margin-top: 12px; font-size: clamp(12px, 2vw, 14px); color: var(--ink3); font-weight: 400; position: relative; letter-spacing: 0.3px; }
  .header-credit {
    margin-top: 22px; padding-top: 18px; border-top: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center; gap: 10px; position: relative;
    flex-wrap: wrap;
  }
  .header-credit-logo {
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 15px; font-weight: 800;
    color: var(--accent); letter-spacing: -0.3px;
  }
  .header-credit-logo span { color: var(--ink2); font-weight: 400; font-size: 13px; }
  .header-credit-sep { color: var(--border); font-size: 18px; }
  .header-credit-name { font-size: 13px; color: var(--ink2); font-weight: 400; }
  .header-credit-name strong { color: var(--ink); font-weight: 600; }
  @media (max-width: 600px) {
    header { padding: 28px 20px 24px; }
    .header-credit-sep { display: none; }
    .header-credit { gap: 6px; flex-direction: column; }
  }

  main { max-width: 1120px; margin: 0 auto; padding: 40px 24px 80px; }

  .input-section {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 32px; margin-bottom: 28px;
    box-shadow: 0 4px 20px var(--shadow);
  }
  @media (max-width: 600px) { .input-section { padding: 20px 16px; border-radius: 16px; } }
  .section-label {
    font-family: 'Fira Code', monospace; font-size: 11px;
    letter-spacing: 2px; text-transform: uppercase; color: var(--ink3); margin-bottom: 20px;
  }
  .input-grid { display: grid; grid-template-columns: 1.2fr 1fr 1fr 1fr 1.4fr 0.9fr 0.9fr; gap: 14px; align-items: end; }
  @media (max-width: 1100px) { .input-grid { grid-template-columns: 1fr 1fr 1fr 1fr; } main { padding: 24px 16px 60px; } }
  @media (max-width: 700px) { .input-grid { grid-template-columns: 1fr 1fr; } }
  @media (max-width: 400px) { .input-grid { grid-template-columns: 1fr; } }

  .field label { display: block; font-size: 12.5px; font-weight: 500; color: var(--ink2); margin-bottom: 7px; }
  .field input, .field select {
    width: 100%; padding: 11px 13px; border: 1.5px solid var(--border); border-radius: 12px;
    font-family: 'Fira Code', monospace; font-size: 14px; background: var(--bg); color: var(--ink);
    outline: none; transition: border-color 0.2s;
  }
  .field input:focus, .field select:focus { border-color: var(--accent); background: var(--card); }
  .input-suffix { position: relative; }
  .input-suffix input { padding-right: 46px; }
  .input-suffix span { position: absolute; right: 11px; top: 50%; transform: translateY(-50%); font-family: 'Fira Code', monospace; font-size: 12px; color: var(--ink3); }

  .calc-btn {
    background: var(--ink); color: var(--bg); border: none; border-radius: 12px;
    padding: 12px 18px; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 14px; font-weight: 700;
    cursor: pointer; transition: background 0.2s, transform 0.1s; width: 100%;
  }
  .calc-btn:hover { background: var(--accent); transform: translateY(-1px); }

  /* EFO reference table */
  .efo-ref {
    background: #F0FFF4; border: 1px solid #9AE6B4; border-radius: 10px;
    padding: 14px 16px; margin-top: 18px;
  }
  .efo-ref-title {
    font-family: 'Fira Code', monospace; font-size: 10px;
    letter-spacing: 1.5px; text-transform: uppercase; color: var(--accent3); margin-bottom: 10px;
  }
  .efo-ref table { width: 100%; border-collapse: collapse; }
  .efo-ref th { font-family: 'Fira Code', monospace; font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: var(--ink3); padding: 5px 8px; text-align: left; }
  .efo-ref td { padding: 5px 8px; font-size: 12.5px; border-top: 1px solid #C6F6D5; }
  .efo-ref td:nth-child(2), .efo-ref td:nth-child(3) { font-family: 'Fira Code', monospace; text-align: right; }
  .efo-ref tr.active-row td { background: rgba(39,103,73,0.1); font-weight: 600; }

  #results { display: none; }
  #results.visible { display: block; }

  .recommendation {
    border-radius: 18px; padding: 22px 26px; margin-bottom: 24px;
    display: flex; align-items: flex-start; gap: 16px; animation: slideIn 0.4s ease;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  .recommendation.best-munkaber { background: #FEF3EC; border-left: 4px solid var(--accent); }
  .recommendation.best-megbizas { background: #EBF4FF; border-left: 4px solid var(--accent2); }
  .recommendation.best-efo      { background: #F0FFF4; border-left: 4px solid var(--accent3); }
  .rec-icon { font-size: 26px; flex-shrink: 0; margin-top: 2px; }
  .rec-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 17px; font-weight: 700; margin-bottom: 5px; }
  .rec-text { font-size: 13px; color: var(--ink2); line-height: 1.65; }

  .cards-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 24px; }
  @media (max-width: 1100px) { .cards-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 600px) { .cards-grid { grid-template-columns: 1fr; } }

  .ekho-toggle-wrap {
    display: flex; align-items: center; gap: 9px;
    background: var(--bg2); border: 1.5px solid var(--border); border-radius: 10px;
    padding: 10px 14px; cursor: pointer; transition: all 0.15s; height: 44px; box-sizing: border-box;
  }
  .ekho-toggle-wrap:hover { border-color: #9F7AEA; }
  .ekho-toggle-wrap.active { background: #FAF5FF; border-color: #9F7AEA; }
  .ekho-toggle-wrap input[type=checkbox] { accent-color: #6B46C1; width: 15px; height: 15px; flex-shrink: 0; cursor: pointer; }
  #ekho-toggle-label { font-size: 12px; color: var(--ink2); line-height: 1.3; }
  .card-ekho.winner { background: #FAF5FF; border-color: #9F7AEA; }
  .card-ekho.winner::after { background: #6B46C1; color: white; }
  .metric-value.kdv-sor { color: #276749; font-size: 12px; }
  .metric-value.szja-fiz { color: var(--accent); font-weight: 600; }
  .metric-value.muted { color: var(--ink3); font-size: 12px; }
  .card-metric .metric-label { font-size: 11.5px; }

  .csaladi-section {
    background: #F0FFF4; border: 1.5px solid #9AE6B4;
    border-radius: 16px; padding: 20px 24px; margin-top: 16px;
  }
  .csaladi-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; font-weight: 700; color: #276749; margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
  .csaladi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: end; }
  @media (max-width: 600px) { .csaladi-grid { grid-template-columns: 1fr; } }
  .eves-card { background: var(--bg2); border-radius: 12px; padding: 14px; text-align: center; }
  .eves-card-label { font-size: 11px; color: var(--ink3); margin-bottom: 6px; }
  .eves-card-val { font-family: 'Fira Code', monospace; font-size: 14px; font-weight: 600; color: var(--ink); }
  .eves-card-sub { font-size: 11px; color: var(--ink3); margin-top: 4px; }
    background: var(--card); border: 1.5px solid var(--border); border-radius: 18px; padding: 22px;
    animation: slideIn 0.4s ease; position: relative; overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .result-card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px var(--shadow); }
  .result-card.winner::after {
    content: '‚úì LEGJOBB'; position: absolute; top: 12px; right: 12px;
    font-family: 'Fira Code', monospace; font-size: 9px; letter-spacing: 1.5px;
    padding: 3px 8px; border-radius: 6px; font-weight: 500;
  }
  .card-munkaber { color: var(--accent); }
  .card-munkaber.winner { background: #FEF9F6; border-color: var(--accent); }
  .card-munkaber.winner::after { background: var(--accent); color: white; }
  .card-megbizas { color: var(--accent2); }
  .card-megbizas.winner { background: #F0F7FF; border-color: var(--accent2); }
  .card-megbizas.winner::after { background: var(--accent2); color: white; }
  .card-efo { color: var(--accent3); }
  .card-efo.winner { background: #F0FFF6; border-color: var(--accent3); }
  .card-efo.winner::after { background: var(--accent3); color: white; }

  .card-type { font-family: 'Fira Code', monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; opacity: 0.7; margin-bottom: 6px; color: currentColor; }
  .card-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 16px; font-weight: 700; color: var(--ink); margin-bottom: 16px; }
  .card-metric { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
  .card-metric:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
  .metric-label { font-size: 11px; color: var(--ink3); margin-bottom: 2px; }
  .metric-value { font-family: 'Fira Code', monospace; font-size: 14px; font-weight: 500; color: var(--ink); }
  .metric-value.highlight { font-size: 20px; color: currentColor; }
  .metric-value.warn { color: #E53E3E; font-size: 13px; }
  .metric-value.muted { color: var(--ink3); font-style: italic; font-size: 12px; }

  .chart-section {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 18px; padding: 26px; margin-bottom: 24px;
    animation: slideIn 0.4s ease 0.15s both;
  }
  .chart-section h3 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 15px; font-weight: 700; margin-bottom: 20px; }
  .chart-bars { display: flex; flex-direction: column; gap: 12px; }
  .bar-row { display: flex; align-items: center; gap: 10px; }
  .bar-label { font-size: 12.5px; color: var(--ink2); width: 145px; flex-shrink: 0; font-weight: 500; }
  .bar-track { flex: 1; height: 34px; background: var(--bg2); border-radius: 6px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 6px; transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); display: flex; align-items: center; padding-left: 10px; width: 0; }
  .bar-fill span { font-family: 'Fira Code', monospace; font-size: 11px; color: white; white-space: nowrap; }
  .bar-val { font-family: 'Fira Code', monospace; font-size: 12px; color: var(--ink); width: 105px; text-align: right; flex-shrink: 0; }
  .bar-munkaber .bar-fill { background: var(--accent); }
  .bar-megbizas .bar-fill { background: var(--accent2); }
  .bar-ekho .bar-fill { background: #9F7AEA; }
  .bar-efo .bar-fill { background: var(--accent3); }
  @media (max-width: 500px) {
    .bar-label { width: 80px; font-size: 11px; }
    .bar-val { width: 80px; font-size: 11px; }
    .bar-fill span { font-size: 10px; }
  }

  .table-section {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 18px; overflow: hidden; margin-bottom: 24px;
    animation: slideIn 0.4s ease 0.1s both;
  }
  .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .table-header { padding: 18px 22px; border-bottom: 1px solid var(--border); }
  .table-header h3 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 15px; font-weight: 700; }
  table.main-table { width: 100%; border-collapse: collapse; min-width: 520px; }
  table.main-table th { background: var(--bg); padding: 10px 16px; text-align: left; font-family: 'Fira Code', monospace; font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: var(--ink3); font-weight: 500; }
  table.main-table td { padding: 11px 16px; font-size: 13px; border-top: 1px solid var(--border); }
  table.main-table tr:hover td { background: var(--bg2); }
  table.main-table td.rl { font-weight: 500; color: var(--ink2); }
  table.main-table td.num { font-family: 'Fira Code', monospace; font-size: 12px; text-align: right; }
  table.main-table tr.tr { }
  table.main-table tr.tr td { background: var(--bg); font-weight: 600; font-family: 'Fira Code', monospace; }

  .notes-section {
    background: var(--bg2); border-radius: 18px; padding: 18px 22px;
    animation: slideIn 0.4s ease 0.2s both;
  }
  .notes-section h4 { font-family: 'Fira Code', monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--ink3); margin-bottom: 10px; }
  .notes-section li { font-size: 12.5px; color: var(--ink2); line-height: 1.7; margin-bottom: 2px; }
  .notes-section ul { padding-left: 16px; }

  .kedvezmeny-section {
    background: #EBF8FF; border: 1.5px solid #90CDF4;
    border-radius: 16px; padding: 20px 24px; margin-top: 20px;
  }
  .kedvezmeny-title {
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; font-weight: 700;
    color: #2B6CB0; margin-bottom: 14px; display: flex; align-items: center; gap: 8px;
  }
  .kedvezmeny-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
  @media (max-width: 900px) { .kedvezmeny-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 500px) { .kedvezmeny-grid { grid-template-columns: 1fr; } }
  .kedvezmeny-item {
    background: white; border: 1.5px solid #BEE3F8; border-radius: 12px;
    padding: 12px 14px; cursor: pointer; transition: all 0.15s;
    display: flex; align-items: flex-start; gap: 10px;
  }
  .kedvezmeny-item:hover { border-color: #2B6CB0; box-shadow: 0 2px 8px rgba(43,108,176,0.12); }
  .kedvezmeny-item.active { background: #dbeeff; border-color: #2B6CB0; }
  .kedvezmeny-item input[type=checkbox] { margin-top: 2px; flex-shrink: 0; accent-color: #2B6CB0; width: 15px; height: 15px; cursor: pointer; }
  .kedvezmeny-label { font-size: 12px; font-weight: 600; color: var(--ink); line-height: 1.4; }
  .kedvezmeny-desc { font-size: 11px; color: var(--ink3); margin-top: 2px; line-height: 1.4; }
  .kedvezmeny-item.disabled { opacity: 0.38; cursor: not-allowed; pointer-events: none; background: var(--bg2); border-color: var(--border); }
  .kedvezmeny-item.disabled .kedvezmeny-label { color: var(--ink3); }
  .kedvezmeny-tiltott-info { margin-top: 10px; padding: 9px 13px; background: #FFF5F5; border: 1px solid #FEB2B2; border-radius: 10px; font-size: 11.5px; color: #C53030; display: none; }
  .kedvezmeny-tiltott-info.visible { display: block; }

  .irany-toggle { display:flex; background: var(--bg2); border-radius: 10px; padding: 3px; gap: 2px; border: 1px solid var(--border); }
  .irany-btn { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 12px; font-weight: 600; padding: 5px 14px; border-radius: 8px; border: none; background: transparent; color: var(--ink3); cursor: pointer; transition: all 0.15s; }
  .irany-btn.active { background: var(--card); color: var(--accent); box-shadow: 0 1px 4px var(--shadow); }
  @media (max-width: 600px) {
    .result-card { padding: 16px; }
    .chart-section { padding: 18px 14px; }
    .recommendation { padding: 16px; }
    .notes-section { padding: 16px; }
    .megbizas-grid { grid-template-columns: 1fr !important; }
  }
</style>
</head>
<body>

<header>
  <div class="header-badge">2026 ¬∑ SukorAD√ì Kalkul√°tor</div>
  <h1>Foglalkoztat√°si Forma<br>√ñsszehasonl√≠t√≥</h1>
  <p>Munkab√©r ¬∑ Megb√≠z√°si szerz≈ëd√©s ¬∑ Egyszer≈±s√≠tett foglalkoztat√°s (EFO)</p>
  <div class="header-credit">
    <div class="header-credit-logo">SukorAD√ì <span>k√∂nyvel≈ëiroda</span></div>
    <div class="header-credit-sep">¬∑</div>
    <div class="header-credit-name">K√©sz√≠tette: <strong>V√°r√≥ci √Ågnes</strong></div>
  </div>
</header>

<main>
  <div class="input-section">
    <div class="section-label" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
      <span id="sectionLabelText">Kiindul√≥pont ‚Äî nett√≥ k√©zhez kapott √∂sszeg</span>
      <div class="irany-toggle" id="iranyToggle">
        <button class="irany-btn active" id="btnNetto" onclick="setIrany('netto')">Nett√≥b√≥l</button>
        <button class="irany-btn" id="btnBrutto" onclick="setIrany('brutto')">Brutt√≥b√≥l</button>
        <button class="irany-btn" id="btnOrab√©r" onclick="setIrany('orab√©r')">√ìrab√©rb≈ël</button>
      </div>
    </div>
    <div class="input-grid">
      <div class="field">
        <label id="osszegLabel">Nett√≥ √∂sszeg (Ft/h√≥)</label>
        <div class="input-suffix">
          <input type="number" id="nettoInput" value="400000" min="1000" step="1000">
          <span>Ft</span>
        </div>
      </div>
      <!-- √ìrab√©r m√≥d mez≈ëk -->
      <div class="field" id="orab√©rMezoWrapper" style="display:none">
        <label style="display:flex;align-items:center;justify-content:space-between;">
          <span id="orab√©rLabel">Brutt√≥ √≥rab√©r</span>
          <div class="irany-toggle" style="scale:0.85;transform-origin:right;">
            <button class="irany-btn active" id="btnOrab√©rBrutto" onclick="setOrab√©rTipus('brutto')">Brutt√≥</button>
            <button class="irany-btn" id="btnOrab√©rNetto" onclick="setOrab√©rTipus('netto')">Nett√≥</button>
          </div>
        </label>
        <div class="input-suffix">
          <input type="number" id="orab√©rInput" value="3000" min="100" step="50" oninput="szamolOrab√©r()">
          <span>Ft/√≥ra</span>
        </div>
      </div>
      <div class="field" id="havioraWrapper" style="display:none">
        <label>H√≥nap (2026-os munka√≥r√°k)</label>
        <select id="honapSelect" onchange="honapValtozas()" style="width:100%;margin-bottom:6px;">
          <option value="">‚Äî H√≥nap kiv√°laszt√°sa ‚Äî</option>
          <option value="168">Janu√°r ‚Äî 168 √≥ra</option>
          <option value="160" selected>Febru√°r ‚Äî 160 √≥ra</option>
          <option value="176">M√°rcius ‚Äî 176 √≥ra</option>
          <option value="160">√Åprilis ‚Äî 160 √≥ra</option>
          <option value="152">M√°jus ‚Äî 152 √≥ra</option>
          <option value="176">J√∫nius ‚Äî 176 √≥ra</option>
          <option value="184">J√∫lius ‚Äî 184 √≥ra</option>
          <option value="160">Augusztus ‚Äî 160 √≥ra</option>
          <option value="176">Szeptember ‚Äî 176 √≥ra</option>
          <option value="168">Okt√≥ber ‚Äî 168 √≥ra</option>
          <option value="168">November ‚Äî 168 √≥ra</option>
          <option value="176">December ‚Äî 176 √≥ra</option>
        </select>
        <div class="input-suffix">
          <input type="number" id="havioraInput" value="160" min="1" max="260" step="0.5" oninput="szamolOrab√©r()">
          <span>√≥ra/h√≥</span>
        </div>
      </div>
      <div class="field">
        <label>C√©g ad√≥z√°sa</label>
        <select id="cegAdozas">
          <option value="tao">TAO ‚Äî 13% szoch√≥</option>
          <option value="kiva">KIVA ‚Äî 10% KIVA</option>
        </select>
      </div>
      <div class="field">
        <label>Munkav√°llal√≥ st√°tusza</label>
        <select id="munkavStatusz" onchange="frissitKedvezmenyElerheto()">
          <option value="normal">√Åltal√°nos (SZJA + TB)</option>
          <option value="nyugdijas">Nyugd√≠jas (csak SZJA)</option>
        </select>
      </div>
      <div class="field">
        <label>Megb√≠z√°s t√≠pusa</label>
        <select id="megbizasTipus">
          <option value="eseti">Eseti megb√≠z√°s</option>
          <option value="tartos">Tart√≥s megb√≠z√°s (Tbj. bej.)</option>
        </select>
      </div>
      <div class="field">
        <label>EFO t√≠pusa</label>
        <select id="efoType" onchange="updateEfoRef()">
          <option value="alkalmi">Alkalmi munka</option>
          <option value="turisztikai">Turisztikai id√©nymunka</option>
          <option value="mezogazd">Mez≈ëgazd. id√©nymunka (0-120 nap)</option>
          <option value="mezogazd2">Mez≈ëgazd. id√©nymunka (121-210 nap)</option>
          <option value="film">Filmipari statiszta</option>
        </select>
      </div>
      <div class="field">
        <label>Napok sz√°ma (EFO, max 15/h√≥)</label>
        <div class="input-suffix">
          <input type="number" id="napokInput" value="15" min="1" max="15">
          <span>nap</span>
        </div>
      </div>
      <div class="field">
        <label>Munkaid≈ë (r√©szmunkaid≈ëh√∂z)</label>
        <div class="input-suffix">
          <input type="number" id="munkaidoInput" value="8" min="1" max="8" step="0.5" oninput="frissitHaviOra()">
          <span>√≥ra</span>
        </div>
      </div>
      <div class="field">
        <label>EKHO jogosults√°g</label>
        <div class="ekho-toggle-wrap" id="ekho-toggle-wrap" onclick="document.getElementById('ekhoJogosult').click()">
          <input type="checkbox" id="ekhoJogosult" onclick="event.stopPropagation()" onchange="frissitEkhoLathatosag()">
          <span id="ekho-toggle-label">Nem jogosult ‚Äî nem sz√°m√≠tjuk</span>
        </div>
      </div>
      <div class="field">
        <label>&nbsp;</label>
        <button class="calc-btn" onclick="calculate()">Kisz√°m√≠t ‚Üí</button>
      </div>
    </div>

    <!-- SZJA kedvezm√©nyek -->
    <div class="kedvezmeny-section">
      <div class="kedvezmeny-title">üíô SZJA kedvezm√©nyek ‚Äî munkab√©r √©s megb√≠z√°s eset√©n</div>
      <div class="kedvezmeny-grid">
        <div class="kedvezmeny-item" id="kdv-25-box" onclick="document.getElementById('kdv25').click()">
          <input type="checkbox" id="kdv25" onchange="toggleKedvezmeny('kdv25')" onclick="event.stopPropagation()">
          <div>
            <div class="kedvezmeny-label">25 √©v alatti fiatal</div>
            <div class="kedvezmeny-desc">SZJA mentess√©g a minim√°lb√©r 2√ó-√©ig (645 600 Ft/h√≥). Felette norm√°l ad√≥z√°s.</div>
          </div>
        </div>
        <div class="kedvezmeny-item" id="kdv-30-box" onclick="document.getElementById('kdv30').click()">
          <input type="checkbox" id="kdv30" onchange="toggleKedvezmeny('kdv30')" onclick="event.stopPropagation()">
          <div>
            <div class="kedvezmeny-label">30 √©v alatti any√°k</div>
            <div class="kedvezmeny-desc">SZJA mentess√©g a minim√°lb√©r 2√ó-√©ig (645 600 Ft/h√≥). 2025.01.01. ut√°n sz√ºletett els≈ë gyermekt≈ël.</div>
          </div>
        </div>
        <div class="kedvezmeny-item" id="kdv-netak-box" onclick="document.getElementById('kdvNetak').click()">
          <input type="checkbox" id="kdvNetak" onchange="toggleKedvezmeny('kdvNetak')" onclick="event.stopPropagation()">
          <div>
            <div class="kedvezmeny-label">4+ gyermekes any√°k (N√âTAK)</div>
            <div class="kedvezmeny-desc">Teljes SZJA mentess√©g ‚Äî korl√°t n√©lk√ºl, √©lethosszig.</div>
          </div>
        </div>
        <div class="kedvezmeny-item" id="kdv-szemelyi-box" onclick="document.getElementById('kdvSzemelyi').click()">
          <input type="checkbox" id="kdvSzemelyi" onchange="toggleKedvezmeny('kdvSzemelyi')" onclick="event.stopPropagation()">
          <div>
            <div class="kedvezmeny-label">Szem√©lyi kedvezm√©ny</div>
            <div class="kedvezmeny-desc">S√∫lyos fogyat√©koss√°g / tart√≥s betegs√©g: min.b√©r 5%-a = ~16 140 Ft/h√≥ ad√≥kedvezm√©ny.</div>
          </div>
        </div>
      </div>
      <div class="kedvezmeny-aktiv-info" id="kedvezmenyInfo"></div>
      <div class="kedvezmeny-tiltott-info" id="kedvezmenyTiltott"></div>
    </div>

    <!-- Csal√°di ad√≥kedvezm√©ny -->
    <div class="csaladi-section">
      <div class="csaladi-title">üë®‚Äçüë©‚Äçüëß Csal√°di ad√≥kedvezm√©ny</div>
      <div class="csaladi-grid">
        <div class="field">
          <label>Eltartott gyermekek sz√°ma</label>
          <select id="gyermekSzam" onchange="frissitCsaladiKedvezmeny()">
            <option value="0">Nincs / nem √©rv√©nyes√≠t</option>
            <option value="1">1 gyermek ‚Äî 1 √ó 20 000 Ft alap ‚Üí 3 000 Ft SZJA</option>
            <option value="2">2 gyermek ‚Äî 2 √ó 40 000 Ft alap ‚Üí 12 000 Ft SZJA</option>
            <option value="3">3 gyermek ‚Äî 3 √ó 66 000 Ft alap ‚Üí 29 700 Ft SZJA</option>
            <option value="4">4 gyermek ‚Äî 4 √ó 66 000 Ft alap ‚Üí 39 600 Ft SZJA</option>
            <option value="5">5 gyermek ‚Äî 5 √ó 66 000 Ft alap ‚Üí 49 500 Ft SZJA</option>
          </select>
        </div>
        <div class="field">
          <label>Megoszt√°s (m√°sik sz√ºl≈ë √©rv√©nyes√≠ti)</label>
          <select id="gyermekMegoszt√°s" onchange="frissitCsaladiKedvezmeny()">
            <option value="1.0">Teljes √∂sszeget √©n √©rv√©nyes√≠tem</option>
            <option value="0.5">50-50% megosztva</option>
          </select>
        </div>
      </div>
      <div id="csaladiInfo" style="display:none;margin-top:12px;padding:10px 14px;background:#276749;border-radius:10px;font-size:12px;color:white;"></div>
    </div>

    <!-- EFO referencia t√°bl√°zat -->
    <div class="efo-ref">
      <div class="efo-ref-title">üìä 2026-os EFO Adatok ‚Äî SukorAD√ì adatb√°zis alapj√°n ¬∑ minim√°lb√©r: 322 800 Ft/h√≥</div>
      <div style="overflow-x:auto;-webkit-overflow-scrolling:touch;">
      <table id="efoRefTable">
        <thead>
          <tr>
            <th>EFO fajt√°ja</th>
            <th style="text-align:right">Munk√°ltat√≥i k√∂zteher/nap</th>
            <th style="text-align:right">Min. kifizetend≈ë napi b√©r</th>
          </tr>
        </thead>
        <tbody id="efoRefBody"></tbody>
      </table>
      </div>
    </div>
  </div>

  <div id="bruttoInfoSav" style="display:none"></div>
  <div id="orab√©rInfoSav" style="display:none;background:#EBF8FF;border:1px solid #90CDF4;border-radius:10px;padding:10px 16px;font-size:13px;color:#2B6CB0;margin-bottom:16px;"></div>
  <div id="results">
    <div id="recommendation" class="recommendation"></div>

    <div class="cards-grid" id="cardsGrid">
      <div class="result-card card-munkaber" id="card-munkaber">
        <div class="card-type">01 ¬∑ Munkab√©r</div>
        <div class="card-title">Hagyom√°nyos alkalmazott</div>
        <div id="munkaber-metrics"></div>
      </div>
      <div class="result-card card-megbizas" id="card-megbizas">
        <div class="card-type">02 ¬∑ Megb√≠z√°s</div>
        <div class="card-title">Megb√≠z√°si szerz≈ëd√©s</div>
        <div id="megbizas-metrics"></div>
      </div>
      <div class="result-card card-ekho" id="card-ekho" style="display:none">
        <div class="card-type">03 ¬∑ EKHO</div>
        <div class="card-title">Egyszer≈±s√≠tett k√∂zteher</div>
        <div id="ekho-metrics"></div>
      </div>
      <div class="result-card card-efo" id="card-efo">
        <div class="card-type">04 ¬∑ EFO</div>
        <div class="card-title">Egyszer≈±s√≠tett foglalkoztat√°s</div>
        <div id="efo-metrics"></div>
      </div>
    </div>

    <div id="eves-osszesito" style="display:none;background:var(--card);border:1px solid var(--border);border-radius:18px;padding:20px 26px;margin-bottom:24px;animation:slideIn 0.4s ease;">
      <div style="font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:700;margin-bottom:16px;">üìÖ √âves √∂sszes√≠t√©s (√ó 12 h√≥nap)</div>
      <div id="eves-grid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;"></div>
    </div>

    <div class="chart-section">
      <h3>Munk√°ltat√≥i √∂sszk√∂ltes√©g √∂sszehasonl√≠t√°sa</h3>
      <div class="chart-bars" id="chartBars"></div>
    </div>

    <div class="table-section">
      <div class="table-header"><h3>R√©szletes j√°rul√©kbont√°s</h3></div>
      <div style="overflow-x:auto">
        <table class="main-table">
          <thead>
            <tr>
              <th>T√©tel</th>
              <th style="text-align:right">Munkab√©r</th>
              <th style="text-align:right">Megb√≠z√°s</th>
              <th style="text-align:right" id="efoColHeader">EFO</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="notes-section">
      <h4>Fontos tudnival√≥k ¬∑ 2026</h4>
      <ul>
        <li><strong>EFO korl√°tok (1 mag√°nszem√©ly):</strong> max 120 nap/√©v | max egybef√ºgg≈ë 5 nap | max havi 15 nap</li>
        <li><strong>Mentes√≠tett keret√∂sszeg</strong> (dolgoz√≥ nem vall be, ha alatta van): Szakk√©pes√≠t√©st NEM ig√©nyl≈ë: <strong>19 305 Ft/nap</strong> (min.b√©r √ó 130%) | Szakk√©pes√≠t√©st ig√©nyl≈ë: <strong>22 308 Ft/nap</strong> (gar.b√©rmin. √ó 130%)</li>
        <li><strong>Max kifizethat√≥ napi b√©r EFO-n√°l:</strong> 29 700 Ft/nap/f≈ë (min.b√©r napi √ó 2 = 10 760 Ft √ó 2)</li>
        <li><strong>L√©tsz√°mkorl√°t:</strong> 1-5 f≈ës c√©g: max 2 f≈ë/nap | 6-20 f≈ës: max 4 f≈ë/nap | 20+ f≈ës: l√©tsz√°m √ó 20% ‚Äî Filmipari statiszt√°n√°l nem vonatkozik!</li>
        <li><strong>Megb√≠z√°sn√°l</strong> biztos√≠tott megb√≠zottat felt√©telez (nincs m√°s TB-k√∂teles jogviszonya). Ha nem biztos√≠tott, a TB-teher is v√°ltozhat.</li>
        <li><strong>10%-os k√∂lts√©g√°tal√°ny</strong> √©rv√©nyes√≠thet≈ë megb√≠z√°sn√°l az SZJA-alap cs√∂kkent√©s√©re</li>
        <li><strong>√öj 2026.01.01-t≈ël:</strong> Tart√≥s megb√≠z√°si jogviszony √∫j fogalma. Mez≈ëgazd. id√©nymunk√°n√°l a 120 nap + 90 nappal meghosszabb√≠that√≥.</li>
      </ul>

      <!-- Megb√≠z√°si jogviszony alkalmazhat√≥s√°gi figyelmeztet√©s -->
      <div style="margin-top:20px;background:#FFF5F5;border:2px solid #FC8181;border-radius:14px;padding:18px 20px;">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
          <span style="font-size:22px;">‚ö†Ô∏è</span>
          <div style="font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:800;color:#C53030;">
            Fontos! A megb√≠z√°si jogviszony nem minden esetben alkalmazhat√≥
          </div>
        </div>
        <p style="font-size:12.5px;color:#742A2A;line-height:1.7;margin-bottom:14px;">
          A megb√≠z√°si szerz≈ëd√©s csak akkor jogszer≈±, ha a felek k√∂z√∂tti kapcsolat <strong>val√≥di megb√≠z√°si jelleg≈±</strong> ‚Äî 
          azaz nem √°ll fenn munkaviszony-szer≈± al√°-f√∂l√© rendelts√©g. A NAV rendszeresen vizsg√°lja √©s √°tmin≈ës√≠theti 
          a val√≥j√°ban munkaviszonynak min≈ës√ºl≈ë megb√≠z√°sokat, ami s√∫lyos b√≠rs√°got vonhat maga ut√°n.
        </p>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;" class="megbizas-grid">
          <div style="background:#F0FFF4;border:1px solid #9AE6B4;border-radius:10px;padding:14px;">
            <div style="font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;color:#276749;margin-bottom:10px;">‚úì Jellemz≈ëen alkalmazhat√≥</div>
            <ul style="padding-left:15px;margin:0;">
              <li style="font-size:12px;color:#276749;line-height:1.75;">Szabadfoglalkoz√°s√∫ szak√©rt≈ëk, tan√°csad√≥k (IT, marketing, p√©nz√ºgy, jog)</li>
              <li style="font-size:12px;color:#276749;line-height:1.75;">Oktat√≥k, tr√©nerek, el≈ëad√≥k ‚Äî alkalmi vagy rendszeres megb√≠z√°sban</li>
              <li style="font-size:12px;color:#276749;line-height:1.75;">K√∂nyvel≈ëk, ad√≥tan√°csad√≥k saj√°t √ºgyfeleikn√©l</li>
              <li style="font-size:12px;color:#276749;line-height:1.75;">Orvosok, eg√©szs√©g√ºgyi szakemberek √ºgyeleti/helyettes√≠t√©si feladatokra</li>
              <li style="font-size:12px;color:#276749;line-height:1.75;">√âp√≠t√©szek, tervez≈ëk, fejleszt≈ëk projekt alapon</li>
              <li style="font-size:12px;color:#276749;line-height:1.75;">√úgyvezet≈ëk, c√©gvezet≈ëk ‚Äî k√ºl√∂n√∂sen ha tagok is egyben</li>
              <li style="font-size:12px;color:#276749;line-height:1.75;">M≈±v√©szek, szerz≈ëk, fot√≥sok egyszeri vagy ism√©tl≈ëd≈ë alkot√°sokra</li>
            </ul>
          </div>
          <div style="background:#FFF5F5;border:1px solid #FEB2B2;border-radius:10px;padding:14px;">
            <div style="font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;color:#C53030;margin-bottom:10px;">‚úó √Åtmin≈ës√≠t√©si kock√°zat ‚Äî NEM alkalmazhat√≥</div>
            <ul style="padding-left:15px;margin:0;">
              <li style="font-size:12px;color:#742A2A;line-height:1.75;">K√∂t√∂tt munkaid≈ëben, meghat√°rozott helyen v√©gzett rendszeres munkav√©gz√©s</li>
              <li style="font-size:12px;color:#742A2A;line-height:1.75;">Ha a megb√≠z√≥ utas√≠t√°si jogot gyakorol a megb√≠zott felett</li>
              <li style="font-size:12px;color:#742A2A;line-height:1.75;">Kiz√°r√≥lag egy megb√≠z√≥nak v√©gzett, folyamatos √©s nem projektjelleg≈± tev√©kenys√©g</li>
              <li style="font-size:12px;color:#742A2A;line-height:1.75;">Ha az eszk√∂z√∂ket, munkaeszk√∂z√∂ket a megb√≠z√≥ biztos√≠tja</li>
              <li style="font-size:12px;color:#742A2A;line-height:1.75;">Ha a tev√©kenys√©g nem k√ºl√∂nb√∂zik a munkav√°llal√≥k feladatait√≥l</li>
            </ul>
          </div>
        </div>
        <p style="font-size:11.5px;color:#742A2A;margin-top:12px;padding-top:10px;border-top:1px solid #FEB2B2;">
          üí° K√©ts√©g eset√©n √©rdemes munkajog√°sszal vagy ad√≥tan√°csad√≥val egyeztetni a jogviszony min≈ës√≠t√©s√©r≈ël.
        </p>
      </div>
    </div>
  </div>
</main>

<script>
// 2026-os adatok ‚Äî SukorAD√ì adatb√°zis alapj√°n
const TAX = { szja: 0.15, munkavTB: 0.185, szocho: 0.13, kiva: 0.10, koltsegalany: 0.10 };

// EFO adatok 2026: minim√°lb√©r 322 800 Ft/h√≥, napi: 10 760 Ft
const EFO = {
  alkalmi:    { label: 'Alkalmi munka',                    napiBer: 13600, kozteher: 4800  },
  turisztikai:{ label: 'Turisztikai id√©nymunka',           napiBer: 6800,  kozteher: 2400  },
  mezogazd:   { label: 'Mez≈ëgazd. id√©nymunka (0-120 nap)', napiBer: 6800,  kozteher: 2400  },
  mezogazd2:  { label: 'Mez≈ëgazd. id√©nymunka (121-210)',   napiBer: 10200, kozteher: 3600  },
  film:       { label: 'Filmipari statiszta',              napiBer: 27100, kozteher: 9700  },
};

function fmt(n) { return Math.round(n).toLocaleString('hu-HU') + ' Ft'; }
function fmtN(n) { return Math.round(n).toLocaleString('hu-HU'); }

function szjaBontasToSorok(szjaTeljes, szjaVegso, bontas, kulcsLabel) {
  // Ha nincs kedvezm√©ny, egy sima sor
  if (!bontas || bontas.length === 0) {
    return [{ l: 'Munkav√°llal√≥ SZJA (' + kulcsLabel + ')', v: szjaVegso === 0 ? '‚Äî (nincs SZJA k√∂telezetts√©g)' : '‚Äì ' + fmt(szjaVegso) }];
  }
  // Van kedvezm√©ny: teljes SZJA, al√° indent√°lva a levon√°sok, v√©g√ºl a fizetend≈ë
  const sorok = [];
  sorok.push({ l: 'SZJA alap (' + kulcsLabel + ')', v: fmt(szjaTeljes), muted: true });
  bontas.forEach(t => {
    sorok.push({ l: '  ‚Ü≥ ' + t.nev, v: '‚Äì ' + fmt(t.osszeg), kdv: true });
  });
  sorok.push({ l: 'Fizetend≈ë SZJA', v: szjaVegso === 0 ? '‚Äî (teljes mentess√©g)' : '‚Äì ' + fmt(szjaVegso), szjaFiz: true });
  return sorok;
}

function updateEfoRef() {
  const sel = document.getElementById('efoType').value;
  const tbody = document.getElementById('efoRefBody');
  tbody.innerHTML = Object.entries(EFO).map(([k, v]) =>
    `<tr class="${k === sel ? 'active-row' : ''}">
      <td>${v.label}</td>
      <td>${fmtN(v.kozteher)} Ft/nap</td>
      <td>${fmtN(v.napiBer)} Ft/nap</td>
    </tr>`
  ).join('');
}

let kalkulatorIrany = 'netto'; // 'netto', 'brutto', 'orab√©r'

function setIrany(irany) {
  kalkulatorIrany = irany;
  document.getElementById('btnNetto').classList.toggle('active', irany === 'netto');
  document.getElementById('btnBrutto').classList.toggle('active', irany === 'brutto');
  document.getElementById('btnOrab√©r').classList.toggle('active', irany === 'orab√©r');

  const orab√©rMod = irany === 'orab√©r';
  document.getElementById('orab√©rMezoWrapper').style.display = orab√©rMod ? '' : 'none';
  document.getElementById('havioraWrapper').style.display = orab√©rMod ? '' : 'none';
  document.getElementById('nettoInput').closest('.field').style.display = orab√©rMod ? 'none' : '';

  if (orab√©rMod) {
    document.getElementById('osszegLabel').textContent = 'Brutt√≥ √∂sszeg (Ft/h√≥)';
    document.getElementById('sectionLabelText').textContent = 'Kiindul√≥pont ‚Äî √≥rab√©r alapj√°n';
    // H√≥nap dropdown alapj√°n friss√≠ti a havi √≥r√°t
    const honapVal = document.getElementById('honapSelect').value;
    if (honapVal) document.getElementById('havioraInput').value = honapVal;
    szamolOrab√©r();
  } else {
    document.getElementById('osszegLabel').textContent = irany === 'netto' ? 'Nett√≥ √∂sszeg (Ft/h√≥)' : 'Brutt√≥ √∂sszeg (Ft/h√≥)';
    document.getElementById('sectionLabelText').textContent = irany === 'netto'
      ? 'Kiindul√≥pont ‚Äî nett√≥ k√©zhez kapott √∂sszeg'
      : 'Kiindul√≥pont ‚Äî brutt√≥ b√©r / megb√≠z√°si d√≠j';
  }
  document.getElementById('results').classList.remove('visible');
  document.getElementById('eves-osszesito').style.display = 'none';
}

function honapValtozas() {
  const val = document.getElementById('honapSelect').value;
  if (val) {
    document.getElementById('havioraInput').value = val;
    szamolOrab√©r();
  }
}

function frissitHaviOra() {
  const ora = parseFloat(document.getElementById('munkaidoInput').value) || 8;
  // Ha 8 √≥r√°s teljes munkaid≈ë, az aktu√°lisan kiv√°lasztott h√≥nap √≥r√°it haszn√°ljuk
  // Ha r√©szmunkaid≈ë, ar√°nyos√≠tjuk
  const honapOra = parseFloat(document.getElementById('havioraInput').value) || 174;
  if (ora < 8) {
    const aranyosOra = Math.round(honapOra * ora / 8 * 10) / 10;
    document.getElementById('havioraInput').value = aranyosOra;
  }
  if (kalkulatorIrany === 'orab√©r') szamolOrab√©r();
}

let orab√©rTipus = 'brutto'; // 'brutto' vagy 'netto'

function setOrab√©rTipus(tipus) {
  orab√©rTipus = tipus;
  document.getElementById('btnOrab√©rBrutto').classList.toggle('active', tipus === 'brutto');
  document.getElementById('btnOrab√©rNetto').classList.toggle('active', tipus === 'netto');
  document.getElementById('orab√©rLabel').textContent = tipus === 'brutto' ? 'Brutt√≥ √≥rab√©r' : 'Nett√≥ √≥rab√©r';
  szamolOrab√©r();
}

function szamolOrab√©r() {
  const orab√©r = parseFloat(document.getElementById('orab√©rInput').value) || 0;
  const haviora = parseFloat(document.getElementById('havioraInput').value) || 174;

  let bruttoHavi;
  if (orab√©rTipus === 'netto') {
    // Nett√≥ √≥rab√©rb≈ël visszasz√°m√≠tjuk a brutt√≥t iterat√≠van (munkab√©r logika)
    const nettoHavi = orab√©r * haviora;
    const isNyugdijas = document.getElementById('munkavStatusz').value === 'nyugdijas';
    const munkavTBRat = isNyugdijas ? 0 : TAX.munkavTB;
    const arany = getReszMunkaidoArany();
    const jarulekAlapMinAranyos = JARULEK_ALAP_MIN * arany;
    let brutto = nettoHavi / (1 - munkavTBRat - TAX.szja);
    for (let i = 0; i < 50; i++) {
      const jarulek_alap = (munkavTBRat > 0 && brutto < jarulekAlapMinAranyos) ? jarulekAlapMinAranyos : brutto;
      const sb = _szjaKedvezmenyAlap(jarulek_alap);
      const bruttoUj = nettoHavi + sb.szja + Math.max(0, jarulek_alap * munkavTBRat - sb.csaladiTbAtmenet);
      if (Math.abs(bruttoUj - brutto) < 0.5) { brutto = bruttoUj; break; }
      brutto = bruttoUj;
    }
    bruttoHavi = Math.round(brutto);
  } else {
    bruttoHavi = Math.round(orab√©r * haviora);
  }

  document.getElementById('nettoInput').value = bruttoHavi;

  const infoEl = document.getElementById('orab√©rInfoSav');
  if (infoEl && bruttoHavi > 0) {
    const nettoMegjegyzes = orab√©rTipus === 'netto'
      ? ` ‚Üí <strong>${bruttoHavi.toLocaleString('hu-HU')} Ft brutt√≥/h√≥</strong>`
      : ` = <strong>${bruttoHavi.toLocaleString('hu-HU')} Ft brutt√≥/h√≥</strong>`;
    infoEl.innerHTML = `${orab√©r.toLocaleString('hu-HU')} Ft/√≥ra (${orab√©rTipus}) √ó ${haviora} √≥ra${nettoMegjegyzes}`;
    infoEl.style.display = 'block';
  }
}

const MINBER_HAVI = 322800;
const JARULEK_ALAP_MIN = MINBER_HAVI * 0.30; // 96 840 Ft
const SZJA_MENTES_HATAR = MINBER_HAVI * 2;   // 645 600 Ft
const SZEMELYI_KEDVEZMENY = MINBER_HAVI * 0.05; // ~16 140 Ft/h√≥
const NAPI_MUNKAID–û_TELJES = 8;
const HAVI_MUNKAORA = 174;

// Csal√°di ad√≥alap-kedvezm√©ny 2026 ‚Äî GYEREKENK√âNT √©rtend≈ë √∂sszeg
// Az ad√≥alap cs√∂kken ezzel, a t√©nyleges SZJA megtakar√≠t√°s = √∂sszeg √ó 15%
const CSALADI_ALAPKDV_GYEREKENKENT = { 1: 20000, 2: 40000 }; // 1 vagy 2 gyerekn√©l gyerekenk√©nt
const CSALADI_ALAPKDV_3PLUS = 66000; // 3+ gyerekn√©l gyerekenk√©nt

// EKHO m√©rt√©k 2026
const EKHO_MERTEKE = 0.15; // 15% ‚Äî munk√°ltat√≥ fizeti

function frissitCsaladiKedvezmeny() {
  const gyermek = parseInt(document.getElementById('gyermekSzam').value) || 0;
  const megoszt√°s = parseFloat(document.getElementById('gyermekMegoszt√°s').value);
  const infoEl = document.getElementById('csaladiInfo');
  if (gyermek === 0) { infoEl.style.display = 'none'; return; }
  const egys√©g√°r = gyermek <= 2 ? (CSALADI_ALAPKDV_GYEREKENKENT[gyermek] || 20000) : CSALADI_ALAPKDV_3PLUS;
  const alapKdv = egys√©g√°r * gyermek;
  const enyemAlap = Math.round(alapKdv * megoszt√°s);
  const szjaMegtakaritas = Math.round(enyemAlap * 0.15);
  infoEl.innerHTML = `‚úì Ad√≥alap-kedvezm√©ny: <strong>${enyemAlap.toLocaleString('hu-HU')} Ft/h√≥</strong> (${gyermek} √ó ${egys√©g√°r.toLocaleString('hu-HU')} Ft) ¬∑ SZJA megtakar√≠t√°s: <strong>${szjaMegtakaritas.toLocaleString('hu-HU')} Ft/h√≥</strong> ¬∑ Ha az SZJA nem fedezi, a TB-be is beleny√∫l.`;
  infoEl.style.display = 'block';
}

function getCsaladiAlapKdv(gyermek) {
  // Ad√≥alap-kedvezm√©ny √∂sszege (gyerekenk√©nt √ó gyereksz√°m)
  if (gyermek <= 0) return 0;
  const egys√©g√°r = gyermek <= 2 ? (CSALADI_ALAPKDV_GYEREKENKENT[gyermek] || 20000) : CSALADI_ALAPKDV_3PLUS;
  return egys√©g√°r * gyermek;
}

function getCsaladiKedvezmeny() {
  // Visszaad: t√©nyleges SZJA megtakar√≠t√°s = ad√≥alap-kedvezm√©ny √ó 15%
  const gyermek = parseInt(document.getElementById('gyermekSzam').value) || 0;
  const megoszt√°s = parseFloat(document.getElementById('gyermekMegoszt√°s').value);
  const alapKdv = getCsaladiAlapKdv(gyermek);
  return Math.round(alapKdv * megoszt√°s * TAX.szja);
}

function frissitEkhoLathatosag() {
  const jogosult = document.getElementById('ekhoJogosult').checked;
  document.getElementById('ekho-toggle-wrap').classList.toggle('active', jogosult);
  document.getElementById('ekho-toggle-label').textContent = jogosult
    ? 'Jogosult ‚Äî EKHO sz√°m√≠t√°s akt√≠v'
    : 'Nem jogosult ‚Äî nem sz√°m√≠tjuk';
  // Eredm√©nyeket t√∂r√∂lj√ºk hogy √∫jra kelljen sz√°molni
  document.getElementById('results').classList.remove('visible');
  document.getElementById('eves-osszesito').style.display = 'none';
}

function isEkhoJogosult() {
  return document.getElementById('ekhoJogosult').checked;
}

function calcEkho(netto) {
  // EKHO: munk√°ltat√≥ fizet 15%-ot a d√≠j ut√°n, munkav√°llal√≥nak nincs tov√°bbi k√∂ztehre
  // (az EKHO-s j√∂vedelmet a munk√°ltat√≥ fizeti be, dolgoz√≥nak nett√≥ = brutt√≥)
  const ekhoOssz = netto * EKHO_MERTEKE;
  return {
    brutto: netto,
    netto: netto,
    szja: 0,
    tb: 0,
    ekhoOssz,
    munkaltOssz: netto + ekhoOssz,
  };
}

function frissitKedvezmenyElerheto() {
  const isNyugdijas = document.getElementById('munkavStatusz').value === 'nyugdijas';
  const boxMap = { 'kdv25': 'kdv-25-box', 'kdv30': 'kdv-30-box', 'kdvNetak': 'kdv-netak-box', 'kdvSzemelyi': 'kdv-szemelyi-box' };

  // Nyugd√≠jasn√°l csak a 25 alatti √©s 30 √©v alatti any√°k tiltott (√©letkori ellentmond√°s)
  // N√âTAK √©s szem√©lyi kedvezm√©ny √©rv√©nyes √©s hat a sz√°m√≠t√°sra
  const tiltottIds = isNyugdijas ? ['kdv25', 'kdv30'] : [];

  tiltottIds.forEach(id => {
    document.getElementById(id).checked = false;
    document.getElementById(boxMap[id]).classList.remove('active');
    document.getElementById(boxMap[id]).classList.add('disabled');
  });

  // Nem tiltottak: disabled elt√°vol√≠t√°s
  Object.keys(boxMap).filter(id => !tiltottIds.includes(id)).forEach(id => {
    document.getElementById(boxMap[id]).classList.remove('disabled');
  });

  // Tiltott figyelmeztet√©s
  const tiltottEl = document.getElementById('kedvezmenyTiltott');
  if (isNyugdijas) {
    tiltottEl.innerHTML = '‚ö†Ô∏è Nyugd√≠jas eset√©n a 25 √©v alatti √©s 30 √©v alatti any√°k kedvezm√©nye nem alkalmazhat√≥ (√©letkori ellentmond√°s). A N√âTAK √©s a szem√©lyi kedvezm√©ny √©rv√©nyes √©s hat a sz√°m√≠t√°sra ‚Äî a nyugd√≠jas munkav√°llal√≥nak van SZJA k√∂telezetts√©ge, TB al√≥l mentes.';
    tiltottEl.classList.add('visible');
  } else {
    tiltottEl.classList.remove('visible');
  }

  updateKedvezmenyInfo();
}

function toggleKedvezmeny(cbId) {
  const exkluziv = ['kdv25', 'kdv30', 'kdvNetak'];
  const boxMap = { 'kdv25': 'kdv-25-box', 'kdv30': 'kdv-30-box', 'kdvNetak': 'kdv-netak-box', 'kdvSzemelyi': 'kdv-szemelyi-box' };

  // Ha exkluz√≠v √©s be van pip√°lva, a m√°sik kett≈ët t√∂r√∂lj√ºk
  if (exkluziv.includes(cbId) && document.getElementById(cbId).checked) {
    exkluziv.filter(id => id !== cbId).forEach(id => {
      document.getElementById(id).checked = false;
      document.getElementById(boxMap[id]).classList.remove('active');
    });
  }

  // Active class friss√≠t√©s
  Object.keys(boxMap).forEach(id => {
    document.getElementById(boxMap[id]).classList.toggle('active', document.getElementById(id).checked);
  });

  updateKedvezmenyInfo();
}

function updateKedvezmenyInfo() {
  const kdv25 = document.getElementById('kdv25').checked;
  const kdv30 = document.getElementById('kdv30').checked;
  const netak = document.getElementById('kdvNetak').checked;
  const szemelyi = document.getElementById('kdvSzemelyi').checked;
  const infoEl = document.getElementById('kedvezmenyInfo');
  const aktiv = [];
  if (kdv25) aktiv.push('25 √©v alatti: SZJA mentes a minim√°lb√©r 2√ó-√©ig (645 600 Ft/h√≥)');
  if (kdv30) aktiv.push('30 √©v alatti any√°k: SZJA mentes a minim√°lb√©r 2√ó-√©ig (645 600 Ft/h√≥)');
  if (netak) aktiv.push('N√âTAK: teljes SZJA mentess√©g, korl√°t n√©lk√ºl');
  if (szemelyi) aktiv.push('Szem√©lyi kedvezm√©ny: 16 140 Ft/h√≥ ad√≥cs√∂kkent√©s');
  if (aktiv.length > 0) {
    infoEl.innerHTML = '‚úì Akt√≠v kedvezm√©ny(ek): ' + aktiv.join(' ¬∑ ');
    infoEl.classList.add('visible');
  } else {
    infoEl.classList.remove('visible');
  }
}

function getSzjaKedvezmeny(brutto, szjaAlap) {
  return _szjaKedvezmenyAlap(szjaAlap).szja;
}

function getSzjaKedvezmenyMegbizas(szjaAlap90) {
  return _szjaKedvezmenyAlap(szjaAlap90).szja;
}

function getCsaladiTbAtmenet(szjaAlap) {
  return _szjaKedvezmenyAlap(szjaAlap).csaladiTbAtmenet;
}

function _szjaKedvezmenyAlap(alap) {
  const kdv25 = document.getElementById('kdv25').checked;
  const kdv30 = document.getElementById('kdv30').checked;
  const netak = document.getElementById('kdvNetak').checked;
  const szemelyi = document.getElementById('kdvSzemelyi').checked;
  const csaladiKdv = getCsaladiKedvezmeny();

  const szjaTeljes = alap * TAX.szja;
  let szja = szjaTeljes;
  const tetelekBontasa = []; // { nev, osszeg }

  if (netak) {
    tetelekBontasa.push({ nev: 'N√âTAK mentess√©g', osszeg: szjaTeljes });
    szja = 0;
  } else if (kdv25 || kdv30) {
    const mentesAlap = Math.min(alap, SZJA_MENTES_HATAR);
    const kdvOssz = mentesAlap * TAX.szja;
    tetelekBontasa.push({ nev: kdv25 ? '25 √©v alatti mentess√©g' : '30 √©v alatti any√°k', osszeg: kdvOssz });
    szja = Math.max(0, alap - SZJA_MENTES_HATAR) * TAX.szja;
  }

  if (szemelyi && !netak) {
    const levon = Math.min(szja, SZEMELYI_KEDVEZMENY);
    if (levon > 0) {
      tetelekBontasa.push({ nev: 'Szem√©lyi kedvezm√©ny', osszeg: levon });
      szja = Math.max(0, szja - levon);
    }
  }

  let csaladiTbAtmenet = 0;
  if (csaladiKdv > 0) {
    const levonSzja = Math.min(szja, csaladiKdv);
    if (levonSzja > 0) {
      tetelekBontasa.push({ nev: 'Csal√°di ad√≥kedvezm√©ny', osszeg: levonSzja });
      szja = Math.max(0, szja - levonSzja);
    }
    csaladiTbAtmenet = Math.max(0, csaladiKdv - levonSzja);
    if (csaladiTbAtmenet > 0) {
      tetelekBontasa.push({ nev: 'Csal√°di kedvezm√©ny (TB-b≈ël)', osszeg: csaladiTbAtmenet });
    }
  }

  return { szja, szjaTeljes, tetelekBontasa, csaladiTbAtmenet };
}

function getReszMunkaidoArany() {
  const ora = parseFloat(document.getElementById('munkaidoInput').value) || 8;
  return Math.min(ora, 8) / 8;
}

function calcMunkaber(netto, munkaltadiRat, munkavTBRat) {
  const arany = getReszMunkaidoArany();
  // R√©szmunkaid≈ën√©l a j√°rul√©kalap minimum is ar√°nyos
  const jarulekAlapMinAranyos = JARULEK_ALAP_MIN * arany;

  let brutto = netto / (1 - munkavTBRat - TAX.szja);
  let jarulek_alap, szja, tb, jarulekAlapMinAlkalmaz = false;

  for (let i = 0; i < 50; i++) {
    jarulek_alap = (munkavTBRat > 0 && brutto < jarulekAlapMinAranyos) ? jarulekAlapMinAranyos : brutto;
    jarulekAlapMinAlkalmaz = (munkavTBRat > 0 && brutto < jarulekAlapMinAranyos);
    const sb = _szjaKedvezmenyAlap(jarulek_alap);
    szja = sb.szja;
    tb = jarulek_alap * munkavTBRat;
    const tbTeny = Math.max(0, tb - sb.csaladiTbAtmenet);
    const bruttoUj = netto + szja + tbTeny;
    if (Math.abs(bruttoUj - brutto) < 0.5) { brutto = bruttoUj; break; }
    brutto = bruttoUj;
  }

  jarulek_alap = (munkavTBRat > 0 && brutto < jarulekAlapMinAranyos) ? jarulekAlapMinAranyos : brutto;
  jarulekAlapMinAlkalmaz = (munkavTBRat > 0 && brutto < jarulekAlapMinAranyos);
  const szjaBontas = _szjaKedvezmenyAlap(jarulek_alap);
  szja = szjaBontas.szja;
  tb = jarulek_alap * munkavTBRat;
  const tbAtmenet = szjaBontas.csaladiTbAtmenet;
  const tbTeny = Math.max(0, tb - tbAtmenet);
  const munkaltAdo = jarulek_alap * munkaltadiRat;
  return { brutto, jarulek_alap, szja, szjaTeljes: szjaBontas.szjaTeljes, szjaBontas: szjaBontas.tetelekBontasa, tb: tbTeny, tbAtmenet, munkaltAdo, munkaltOssz: brutto + munkaltAdo, netto, jarulekAlapMinAlkalmaz, arany };
}

function calcMegbizas(netto, munkaltadiRat, munkavTBRat, tartos) {
  // Biztos√≠tott-e?
  // - Tart√≥s megb√≠z√°s: mindig biztos√≠tott, min. j√°rul√©kalap = minim√°lb√©r 30%
  // - Eseti: csak ha d√≠j >= minim√°lb√©r 30%
  // - Nyugd√≠jas (munkavTBRat=0): soha nem biztos√≠tott TB szempontj√°b√≥l

  let dij, tb, munkaltAdo, jarulek_alap, nemBiztositott, tartosBiztAlkalmaz = false;
  const szjaRatMb = (1 - TAX.koltsegalany) * TAX.szja;

  if (munkavTBRat === 0) {
    // Nyugd√≠jas: iterat√≠v visszasz√°m√≠t√°s, csak SZJA (90% alap)
    dij = netto / (1 - szjaRatMb); // kiindul√≥pont
    for (let i = 0; i < 50; i++) {
      const s = getSzjaKedvezmenyMegbizas(dij * (1 - TAX.koltsegalany));
      const dijUj = netto + s;
      if (Math.abs(dijUj - dij) < 0.5) { dij = dijUj; break; }
      dij = dijUj;
    }
    tb = 0; munkaltAdo = 0; jarulek_alap = dij; nemBiztositott = true;
  } else if (tartos) {
    // Tart√≥s: mindig biztos√≠tott, min. j√°rul√©kalap
    const dijNormal = netto / (1 - munkavTBRat - szjaRatMb);
    if (dijNormal < JARULEK_ALAP_MIN) {
      // Iterat√≠v: nett√≥ = d√≠j - szja(min_alap√ó90%) - TB(min_alap)
      dij = netto + JARULEK_ALAP_MIN * (munkavTBRat + szjaRatMb); // kiindul√≥pont
      jarulek_alap = JARULEK_ALAP_MIN;
      for (let i = 0; i < 50; i++) {
        const s = getSzjaKedvezmenyMegbizas(jarulek_alap * (1 - TAX.koltsegalany));
        const dijUj = netto + s + jarulek_alap * munkavTBRat;
        if (Math.abs(dijUj - dij) < 0.5) { dij = dijUj; break; }
        dij = dijUj;
      }
      tartosBiztAlkalmaz = true;
    } else {
      dij = dijNormal; jarulek_alap = dij;
      for (let i = 0; i < 50; i++) {
        const s = getSzjaKedvezmenyMegbizas(dij * (1 - TAX.koltsegalany));
        const dijUj = netto + s + dij * munkavTBRat;
        if (Math.abs(dijUj - dij) < 0.5) { dij = dijUj; break; }
        dij = dijUj; jarulek_alap = dij;
      }
    }
    tb = jarulek_alap * munkavTBRat;
    munkaltAdo = jarulek_alap * munkaltadiRat;
    nemBiztositott = false;
  } else {
    // Eseti: biztos√≠tott csak ha d√≠j >= 96 840 Ft
    let dijProba = netto / (1 - munkavTBRat - szjaRatMb);
    if (dijProba < JARULEK_ALAP_MIN) {
      // Nem biztos√≠tott: csak SZJA
      dij = netto / (1 - szjaRatMb);
      for (let i = 0; i < 50; i++) {
        const s = getSzjaKedvezmenyMegbizas(dij * (1 - TAX.koltsegalany));
        const dijUj = netto + s;
        if (Math.abs(dijUj - dij) < 0.5) { dij = dijUj; break; }
        dij = dijUj;
      }
      tb = 0; munkaltAdo = 0; jarulek_alap = dij; nemBiztositott = true;
    } else {
      dij = dijProba; jarulek_alap = dij;
      for (let i = 0; i < 50; i++) {
        const s = getSzjaKedvezmenyMegbizas(dij * (1 - TAX.koltsegalany));
        const dijUj = netto + s + dij * munkavTBRat;
        if (Math.abs(dijUj - dij) < 0.5) { dij = dijUj; break; }
        dij = dijUj; jarulek_alap = dij;
      }
      tb = dij * munkavTBRat;
      munkaltAdo = dij * munkaltadiRat;
      nemBiztositott = false;
    }
  }

  const szjaBontasMb = _szjaKedvezmenyAlap(jarulek_alap * (1 - TAX.koltsegalany));
  const szja = szjaBontasMb.szja;
  return { brutto: dij, jarulek_alap, szja, szjaTeljes: szjaBontasMb.szjaTeljes, szjaBontas: szjaBontasMb.tetelekBontasa, tb, munkaltAdo, munkaltOssz: dij + munkaltAdo, netto, nemBiztositott, tartosBiztAlkalmaz };
}

function calcEfo(netto, napok, efoKey) {
  const efo = EFO[efoKey];
  const kozteher = efo.kozteher * napok;
  const napiKif = netto / napok;

  // Mentes√≠tett keret√∂sszeg: szakk√©pes√≠t√©st nem ig√©nyl≈ë = 19 305 Ft/nap, ig√©nyl≈ë = 22 308 Ft/nap
  const mentesitettNemKepzett = 19305; // minim√°lb√©r √ó 130%
  const mentesitettKepzett    = 22308; // gar.b√©rmin. √ó 130%
  const mentesitettOsszNemKepzett = mentesitettNemKepzett * napok;
  const mentesitettOsszKepzett    = mentesitettKepzett    * napok;

  // SZJA sz√°m√≠t√°sa ha meghaladja a mentes√≠tett keretet
  const tullepesNemKepzett = Math.max(0, netto - mentesitettOsszNemKepzett);
  const tullepesKepzett    = Math.max(0, netto - mentesitettOsszKepzett);
  const szjaNemKepzett = tullepesNemKepzett * 0.15;
  const szjaKepzett    = tullepesKepzett    * 0.15;

  return {
    label: efo.label, napiBer: efo.napiBer, kozteherPerNap: efo.kozteher,
    napiKif, napok, kozteher, munkaltOssz: netto + kozteher, netto,
    mentesitettNapNemKepzett: mentesitettNemKepzett,
    mentesitettNapKepzett:    mentesitettKepzett,
    mentesitettOsszNemKepzett, mentesitettOsszKepzett,
    tullepesNemKepzett, tullepesKepzett,
    szjaNemKepzett, szjaKepzett,
    mentesitettAtlepve: netto > mentesitettOsszNemKepzett,
  };
}

function calcMunkaberBruttobol(brutto, munkaltadiRat, munkavTBRat) {
  // Brutt√≥b√≥l sz√°molunk egyenesen ‚Äî nincs visszasz√°m√≠t√°s
  const jarulek_alap = (munkavTBRat > 0 && brutto < JARULEK_ALAP_MIN) ? JARULEK_ALAP_MIN : brutto;
  const jarulekAlapMinAlkalmaz = (munkavTBRat > 0 && brutto < JARULEK_ALAP_MIN);
  const szjaBontas = _szjaKedvezmenyAlap(jarulek_alap);
  const szja = szjaBontas.szja;
  const tb = jarulek_alap * munkavTBRat;
  const munkaltAdo = jarulek_alap * munkaltadiRat;
  const netto = brutto - szja - tb;
  return { brutto, jarulek_alap, szja, szjaTeljes: szjaBontas.szjaTeljes, szjaBontas: szjaBontas.tetelekBontasa, tb, munkaltAdo, munkaltOssz: brutto + munkaltAdo, netto, jarulekAlapMinAlkalmaz };
}

function calcMegbizasBruttobol(brutto, munkaltadiRat, munkavTBRat, tartos) {
  // Megb√≠z√°si d√≠j brutt√≥b√≥l egyenesen
  const szjaRatMb = (1 - TAX.koltsegalany) * TAX.szja;
  let tb, munkaltAdo, jarulek_alap, nemBiztositott, tartosBiztAlkalmaz = false;

  if (munkavTBRat === 0) {
    // Nyugd√≠jas
    jarulek_alap = brutto;
    tb = 0; munkaltAdo = 0; nemBiztositott = true;
  } else if (tartos) {
    jarulek_alap = Math.max(brutto, JARULEK_ALAP_MIN);
    tartosBiztAlkalmaz = brutto < JARULEK_ALAP_MIN;
    tb = jarulek_alap * munkavTBRat;
    munkaltAdo = jarulek_alap * munkaltadiRat;
    nemBiztositott = false;
  } else {
    if (brutto < JARULEK_ALAP_MIN) {
      jarulek_alap = brutto; tb = 0; munkaltAdo = 0; nemBiztositott = true;
    } else {
      jarulek_alap = brutto;
      tb = brutto * munkavTBRat;
      munkaltAdo = brutto * munkaltadiRat;
      nemBiztositott = false;
    }
  }

  const szjaBontasMbB = _szjaKedvezmenyAlap(jarulek_alap * (1 - TAX.koltsegalany));
  const szja = szjaBontasMbB.szja;
  const netto = brutto - szja - tb;
  return { brutto, jarulek_alap, szja, szjaTeljes: szjaBontasMbB.szjaTeljes, szjaBontas: szjaBontasMbB.tetelekBontasa, tb, munkaltAdo, munkaltOssz: brutto + munkaltAdo, netto, nemBiztositott, tartosBiztAlkalmaz };
}

function calculate() {
  const inputOssz = parseFloat(document.getElementById('nettoInput').value) || 0;
  const napok = parseInt(document.getElementById('napokInput').value) || 15;
  const efoKey = document.getElementById('efoType').value;
  const cegAdozas = document.getElementById('cegAdozas').value;
  const isKiva = cegAdozas === 'kiva';
  const isNyugdijas = document.getElementById('munkavStatusz').value === 'nyugdijas';
  const isTartos = document.getElementById('megbizasTipus').value === 'tartos';
  const munkaltadiRat = (isKiva && !isNyugdijas) ? TAX.kiva : (!isNyugdijas ? TAX.szocho : 0);
  const munkaltadiLabel = isNyugdijas ? 'Munk√°ltat√≥i j√°rul√©k (nyugd√≠jas: mentes)' : (isKiva ? 'KIVA (10%)' : 'Szoch√≥ (13%)');
  const munkavTBRat = isNyugdijas ? 0 : TAX.munkavTB;

  if (inputOssz < 1000) { alert('Legal√°bb 1 000 Ft-ot adjon meg!'); return; }

  let netto, m, mb;
  let bruttoInfo = null;
  const isBruttoMod = kalkulatorIrany === 'brutto' || kalkulatorIrany === 'orab√©r';

  if (isBruttoMod) {
    const brutto = inputOssz;
    m  = calcMunkaberBruttobol(brutto, munkaltadiRat, munkavTBRat);
    mb = calcMegbizasBruttobol(brutto, munkaltadiRat, munkavTBRat, isTartos);
    netto = m.netto;
    bruttoInfo = { brutto, szja: m.szja, tb: m.tb, netto: m.netto };
  } else {
    netto = inputOssz;
    m  = calcMunkaber(netto, munkaltadiRat, munkavTBRat);
    mb = calcMegbizas(netto, munkaltadiRat, munkavTBRat, isTartos);
  }

  const efoNetto = isBruttoMod ? inputOssz : netto;
  const e = calcEfo(efoNetto, napok, efoKey);
  const ekhoAktiv = isEkhoJogosult();
  const ekho = ekhoAktiv ? calcEkho(isBruttoMod ? inputOssz : netto, munkaltadiRat) : null;

  const EFO_MAX_NAPI = 29700;
  const efoMaxNetto = EFO_MAX_NAPI * napok;
  const efoNemLehetseges = efoNetto > efoMaxNetto;

  const costs = [
    { key: 'munkaber', label: 'Munkab√©r', cost: m.munkaltOssz },
    { key: 'megbizas', label: 'Megb√≠z√°s', cost: mb.munkaltOssz },
    ...(ekhoAktiv ? [{ key: 'ekho', label: 'EKHO', cost: ekho.munkaltOssz }] : []),
    ...(!efoNemLehetseges ? [{ key: 'efo', label: 'EFO', cost: e.munkaltOssz }] : []),
  ].sort((a, b) => a.cost - b.cost);
  const winner = costs[0].key;

  document.querySelector('#card-megbizas .card-title').textContent = isTartos ? 'Tart√≥s megb√≠z√°s (Tbj.)' : 'Megb√≠z√°si szerz≈ëd√©s';
  document.querySelector('#card-megbizas .card-type').textContent = isTartos ? '02 ¬∑ Tart√≥s megb√≠z√°s' : '02 ¬∑ Megb√≠z√°s';

  // K√°rty√°k
  ['munkaber', 'megbizas'].forEach(t => {
    const data = t === 'munkaber' ? m : mb;
    document.getElementById('card-' + t).classList.toggle('winner', winner === t);

    let sorok = [];

    if (t === 'munkaber') {
      const jarulekAlapSor = m.jarulekAlapMinAlkalmaz
        ? [{ l: '‚ö†Ô∏è J√°rul√©kalap (min. 30% = ' + fmt(JARULEK_ALAP_MIN) + ')', v: fmt(m.jarulek_alap), w: true }]
        : [];
      const tbSor = isNyugdijas
        ? { l: 'Munkav√°llal√≥ TB j√°rul√©k', v: '‚Äî (nyugd√≠jas, mentes)' }
        : { l: 'Munkav√°llal√≥ TB j√°rul√©k (18,5%)', v: '‚Äì ' + fmt(data.tb) };
      const szjaSorok = szjaBontasToSorok(data.szjaTeljes, data.szja, data.szjaBontas, '15%');
      sorok = [
        { l: 'Brutt√≥ b√©r', v: fmt(data.brutto) },
        ...jarulekAlapSor,
        ...szjaSorok,
        tbSor,
        { l: 'Nett√≥ k√©zhez', v: fmt(data.netto), h: true },
        { l: 'Munk√°ltat√≥i ' + (isNyugdijas ? 'j√°rul√©k' : munkaltadiLabel), v: isNyugdijas ? '‚Äî (nyugd√≠jas, mentes)' : fmt(data.munkaltAdo) },
        { l: 'Munk√°ltat√≥ √∂sszk√∂lts√©ge', v: fmt(data.munkaltOssz) },
      ];
    } else {
      // Megb√≠z√°s
      let biztStatusz;
      if (isNyugdijas) {
        biztStatusz = { l: 'Biztos√≠t√°si jogviszony', v: '‚Äî (nyugd√≠jas, mentes)' };
      } else if (isTartos) {
        biztStatusz = { l: 'Megb√≠z√°s t√≠pusa', v: '‚úì Tart√≥s megb√≠z√°s (Tbj. bej.) ‚Äî folyamatos biztos√≠tott' };
      } else if (mb.nemBiztositott) {
        biztStatusz = { l: 'Biztos√≠t√°si jogviszony', v: '‚úó Nem biztos√≠tott (d√≠j < ' + fmt(JARULEK_ALAP_MIN) + ')', w: true };
      } else {
        biztStatusz = { l: 'Biztos√≠t√°si jogviszony', v: '‚úì Biztos√≠tott' };
      }

      const tartosSor = mb.tartosBiztAlkalmaz
        ? [{ l: '‚ö†Ô∏è J√°rul√©kalap (min. 30% = ' + fmt(JARULEK_ALAP_MIN) + ')', v: fmt(mb.jarulek_alap), w: true }]
        : [];

      const tbSor = mb.nemBiztositott
        ? { l: 'Munkav√°llal√≥ TB j√°rul√©k', v: '‚Äî (nem biztos√≠tott)' }
        : { l: 'Munkav√°llal√≥ TB j√°rul√©k (18,5%)', v: '‚Äì ' + fmt(data.tb) };
      const munkaltSor = mb.nemBiztositott
        ? { l: 'Munk√°ltat√≥i j√°rul√©k', v: '‚Äî (nem biztos√≠tott)' }
        : { l: 'Munk√°ltat√≥i ' + munkaltadiLabel, v: fmt(data.munkaltAdo) };
      const szjaSorokMb = szjaBontasToSorok(data.szjaTeljes, data.szja, data.szjaBontas, '90% √ó 15%');
      sorok = [
        { l: 'Megb√≠z√°si d√≠j (brutt√≥)', v: fmt(data.brutto) },
        biztStatusz,
        ...tartosSor,
        ...szjaSorokMb,
        tbSor,
        { l: 'Nett√≥ k√©zhez', v: fmt(data.netto), h: true },
        munkaltSor,
        { l: 'Munk√°ltat√≥ √∂sszk√∂lts√©ge', v: fmt(data.munkaltOssz) },
      ];
    }

    document.getElementById(t + '-metrics').innerHTML = sorok
      .map(r => {
        let valClass = 'metric-value';
        if (r.h) valClass += ' highlight';
        if (r.muted) valClass += ' muted';
        if (r.w) valClass += ' warn';
        if (r.kdv) valClass += ' kdv-sor';
        if (r.szjaFiz) valClass += ' szja-fiz';
        const rowStyle = r.kdv ? ' style="background:var(--bg2);border-radius:6px;margin:1px 0;"' : '';
        return `<div class="card-metric"${rowStyle}><div class="metric-label">${r.l}</div><div class="${valClass}">${r.v}</div></div>`;
      })
      .join('');
  });

  // EFO k√°rtya
  document.getElementById('card-efo').classList.toggle('winner', winner === 'efo');

  if (efoNemLehetseges) {
    document.getElementById('card-efo').classList.remove('winner');
    document.getElementById('efo-metrics').innerHTML = `
      <div style="background:#FED7D7;border:1.5px solid #FC8181;border-radius:12px;padding:16px;text-align:center;margin-top:8px;">
        <div style="font-size:22px;margin-bottom:8px;">üö´</div>
        <div style="font-weight:700;color:#C53030;font-size:14px;margin-bottom:6px;">EFO nem alkalmazhat√≥</div>
        <div style="font-size:12px;color:#742A2A;line-height:1.6;">
          A kifizetett nett√≥ √∂sszeg meghaladja a maxim√°lisan<br>
          kifizethet≈ë EFO b√©rt:<br>
          <strong>${napok} nap √ó 29 700 Ft = ${fmt(EFO_MAX_NAPI * napok)} Ft</strong>
        </div>
      </div>`;
  } else {
  const napMaxWarn = e.napiKif > 29700;
  const MINBER_ORABR = MINBER_HAVI / 174; // ~1 855 Ft/√≥ra
  const napiMinWarn = e.napiKif < e.napiBer;
  const maxOra = napiMinWarn ? (e.napiKif / MINBER_ORABR).toFixed(1) : null;

  let efoRows = [
    { l: 'EFO t√≠pusa', v: e.label },
    { l: 'Minim√°lisan kifizetend≈ë napi b√©r', v: fmt(e.napiBer) + '/nap', c: napiMinWarn ? 'warn' : '' },
    { l: 'T√©nylegesen kifizetett napi', v: fmt(e.napiKif) + '/nap' + (napMaxWarn ? ' ‚ö†Ô∏è' : '') + (napiMinWarn ? ' ‚ö†Ô∏è' : ''), c: (napMaxWarn || napiMinWarn) ? 'warn' : '' },
    { l: 'Nett√≥ k√©zhez (' + napok + ' nap)', v: fmt(e.netto), h: true },
    { l: 'K√∂zteher/nap √ó ' + napok + ' nap', v: fmtN(e.kozteherPerNap) + ' √ó ' + napok + ' = ' + fmt(e.kozteher) },
    { l: 'Munk√°ltat√≥ √∂sszk√∂lts√©ge', v: fmt(e.munkaltOssz) },
  ];
  document.getElementById('efo-metrics').innerHTML = efoRows.map(r =>
    `<div class="card-metric"><div class="metric-label">${r.l}</div><div class="metric-value${r.h?' highlight':''} ${r.c||''}">${r.v}</div></div>`
  ).join('');

  if (napMaxWarn) {
    document.getElementById('efo-metrics').innerHTML += '<div style="background:#FED7D7;border-radius:8px;padding:9px 12px;font-size:11.5px;color:#C53030;margin-top:8px;">‚ö†Ô∏è A kifizetett napi b√©r meghaladja a max. 29 700 Ft/nap korl√°tot!</div>';
  }

  if (napiMinWarn) {
    document.getElementById('efo-metrics').innerHTML += `
      <div style="background:#FFFBEB;border:1px solid #F6E05E;border-radius:8px;padding:10px 13px;font-size:12px;color:#7A5F00;margin-top:8px;line-height:1.65;">
        ‚ö†Ô∏è <strong>A kifizetett napi √∂sszeg (${fmt(e.napiKif)}) kisebb a minim√°lis EFO napi b√©rn√©l (${fmt(e.napiBer)}).</strong><br>
        Ez akkor jogszer≈±, ha a dolgoz√≥ aznap kevesebbet dolgozik ‚Äî a be√≠rt √∂sszeg legfeljebb
        <strong>${maxOra} √≥ra</strong> munk√°nak felel meg minim√°lb√©r alapj√°n (${Math.round(MINBER_ORABR).toLocaleString('hu-HU')} Ft/√≥ra).<br>
        <span style="font-size:11px;opacity:0.8;">Minim√°lb√©r √≥rab√©r = 322 800 Ft √∑ 174 √≥ra/h√≥</span>
      </div>`;
  }

  // Mentes√≠tett keret√∂sszeg t√°j√©koztat√≥ SZJA
  if (e.mentesitettAtlepve) {
    const szjaInfoHtml = `
      <div style="background:#FFFBEB;border:1px solid #F6C90E;border-radius:8px;padding:12px 14px;margin-top:10px;font-size:12px;color:#7A5F00;">
        <div style="font-family:'DM Mono',monospace;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;color:#B45309;">
          ‚ö†Ô∏è T√°j√©koztat√≥ ‚Äî Mentes√≠tett keret √°tl√©pve
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px 16px;margin-bottom:8px;">
          <div style="font-size:11px;color:#92400E;font-weight:600;">Szakk√©pes√≠t√©st NEM ig√©nyl≈ë</div>
          <div style="font-size:11px;color:#92400E;font-weight:600;">Szakk√©pes√≠t√©st ig√©nyl≈ë</div>
          <div>Mentes√≠tett: <strong>${fmt(e.mentesitettOsszNemKepzett)}</strong><br>(${fmtN(e.mentesitettNapNemKepzett)} Ft/nap √ó ${napok} nap)</div>
          <div>Mentes√≠tett: <strong>${fmt(e.mentesitettOsszKepzett)}</strong><br>(${fmtN(e.mentesitettNapKepzett)} Ft/nap √ó ${napok} nap)</div>
          <div>Keret felett: <strong>${fmt(e.tullepesNemKepzett)}</strong></div>
          <div>Keret felett: <strong>${e.tullepesKepzett > 0 ? fmt(e.tullepesKepzett) : '‚Äî'}</strong></div>
          <div style="color:#C53030;font-weight:700;">Fizetend≈ë SZJA (15%): ${fmt(e.szjaNemKepzett)}</div>
          <div style="color:${e.szjaKepzett > 0 ? '#C53030' : '#276749'};font-weight:700;">Fizetend≈ë SZJA (15%): ${e.szjaKepzett > 0 ? fmt(e.szjaKepzett) : '0 Ft ‚úì'}</div>
        </div>
        <div style="font-size:11px;border-top:1px solid #F6C90E;padding-top:7px;color:#92400E;">
          A dolgoz√≥nak SZJA-bevall√°st kell beny√∫jtania √©s ad√≥t fizetnie a mentes√≠tett keret feletti √∂sszeg ut√°n.
        </div>
      </div>`;
    document.getElementById('efo-metrics').innerHTML += szjaInfoHtml;
  } else {
    document.getElementById('efo-metrics').innerHTML += `
      <div style="background:#F0FFF4;border:1px solid #9AE6B4;border-radius:8px;padding:10px 14px;margin-top:10px;font-size:12px;color:#276749;">
        ‚úì <strong>Mentes√≠tett kereten bel√ºl</strong> ‚Äî a dolgoz√≥nak nem kell SZJA-t fizetnie √©s bevall√°st beny√∫jtania.<br>
        <span style="font-size:11px;opacity:0.8;">Nem k√©pzett: max ${fmt(e.mentesitettOsszNemKepzett)} | K√©pzett: max ${fmt(e.mentesitettOsszKepzett)}</span>
      </div>`;
  }
  } // end !efoNemLehetseges

  // EKHO k√°rtya ‚Äî csak ha jogosult
  const csaladiKdvOssz = getCsaladiKedvezmeny();
  document.getElementById('card-ekho').style.display = ekhoAktiv ? '' : 'none';
  if (ekhoAktiv) {
    document.getElementById('card-ekho').classList.toggle('winner', winner === 'ekho');
    document.getElementById('ekho-metrics').innerHTML = [
      { l: 'Megb√≠z√°si d√≠j (brutt√≥ = nett√≥)', v: fmt(ekho.brutto) },
      { l: 'Munkav√°llal√≥ SZJA / TB', v: '‚Äî (EKHO kiv√°ltja)' },
      { l: 'Nett√≥ k√©zhez', v: fmt(ekho.netto), h: true },
      { l: 'EKHO k√∂zteher (15%)', v: fmt(ekho.ekhoOssz) },
      { l: 'Munk√°ltat√≥ √∂sszk√∂lts√©ge', v: fmt(ekho.munkaltOssz) },
    ].map(r => `<div class="card-metric"><div class="metric-label">${r.l}</div><div class="metric-value${r.h?' highlight':''}">${r.v}</div></div>`).join('') +
    `<div style="background:#FAF5FF;border:1px solid #D6BCFA;border-radius:8px;padding:9px 12px;font-size:11.5px;color:#553C9A;margin-top:10px;line-height:1.6;">
      ‚ÑπÔ∏è EKHO csak meghat√°rozott tev√©kenys√©gekn√©l alkalmazhat√≥ (el≈ëad√≥m≈±v√©sz, sportol√≥, √∫js√°g√≠r√≥, stb.). √âvi max. 60 M Ft j√∂vedelmig.
    </div>`;
  }

  // R√©szmunkaid≈ë jelz√©s a munkab√©r k√°rty√°n
  const arany = getReszMunkaidoArany();
  if (arany < 1) {
    const ora = parseFloat(document.getElementById('munkaidoInput').value);
    document.getElementById('munkaber-metrics').innerHTML +=
      `<div style="background:#EBF8FF;border:1px solid #90CDF4;border-radius:8px;padding:8px 12px;font-size:11.5px;color:#2B6CB0;margin-top:8px;">
        ‚è±Ô∏è R√©szmunkaid≈ë: ${ora} √≥ra/nap ‚Äî j√°rul√©kalap minimum ar√°nyos√≠tva (${fmt(JARULEK_ALAP_MIN * arany)}/h√≥)
      </div>`;
  }

  // Csal√°di ad√≥kedvezm√©ny TB-be ny√∫l√°s jelz√©se
  if (csaladiKdvOssz > 0 && m.tbAtmenet > 0) {
    document.getElementById('munkaber-metrics').innerHTML +=
      `<div style="background:#F0FFF4;border:1px solid #9AE6B4;border-radius:8px;padding:8px 12px;font-size:11.5px;color:#276749;margin-top:8px;">
        üë®‚Äçüë©‚Äçüëß Ad√≥visszat√©r√≠t√©s: a ${fmt(csaladiKdvOssz)} Ft/h√≥ csal√°di kedvezm√©nyb≈ël ${fmt(m.tbAtmenet)} Ft TB-b≈ël ker√ºl levon√°sra.
      </div>`;
  }

  // Aj√°nl√°s
  const megtakaritas = costs.length > 1 ? costs[1].cost - costs[0].cost : 0;
  const recEl = document.getElementById('recommendation');
  const recData = {
    munkaber: { icon: 'üíº', title: 'Munkab√©r a leggazdas√°gosabb', text: `Enn√©l a szintn√©l a hagyom√°nyos munkab√©r ker√ºl a legkevesebbe a munk√°ltat√≥nak.${efoNemLehetseges ? ' (EFO nem alkalmazhat√≥: meghaladja a ' + fmt(EFO_MAX_NAPI * napok) + ' Ft-os max. korl√°tot.)' : ''}` },
    megbizas: { icon: 'üìã', title: 'Megb√≠z√°s a leggazdas√°gosabb', text: `A 10%-os k√∂lts√©g√°tal√°nynak k√∂sz√∂nhet≈ëen a megb√≠z√°si forma most olcs√≥bb.${efoNemLehetseges ? ' (EFO nem alkalmazhat√≥.)' : ''}` },
    ekho:     { icon: 'üü£', title: 'EKHO a leggazdas√°gosabb', text: `A 15%-os EKHO most a legolcs√≥bb megold√°s. Figyelem: csak meghat√°rozott tev√©kenys√©gekn√©l alkalmazhat√≥!` },
    efo:      { icon: '‚ö°', title: 'EFO a leggazdas√°gosabb', text: `${e.label} eset√©n a munk√°ltat√≥i k√∂zteher ${fmt(e.kozteher)} (${napok} nap √ó ${fmtN(e.kozteherPerNap)} Ft). Max 15 nap/h√≥ √©s 120 nap/√©v korl√°tot figyeljen!` },
  }[winner];
  recEl.className = 'recommendation best-' + winner;
  recEl.innerHTML = `<div class="rec-icon">${recData.icon}</div><div>
    <div class="rec-title">${recData.title}</div>
    <div class="rec-text">${recData.text}<br><br>
      ${costs.length > 1 ? '<strong>Megtakar√≠t√°s a 2. legolcs√≥bbhoz k√©pest: ' + fmt(megtakaritas) + '/h√≥</strong><br>' : ''}
      Sorrend: ${costs.map((c,i) => `${i+1}. ${c.label} (${fmt(c.cost)})`).join(' ‚Üí ')}${efoNemLehetseges ? ' ¬∑ <span style="color:#C53030">EFO: kiz√°rva</span>' : ''}
    </div></div>`;

  // Grafikon
  const chartEl = document.getElementById('chartBars');
  const maxCost = Math.max(...costs.map(c => c.cost));
  chartEl.innerHTML = [...costs].sort((a,b)=>b.cost-a.cost).map(c => `
    <div class="bar-row bar-${c.key}">
      <div class="bar-label">${c.label}</div>
      <div class="bar-track"><div class="bar-fill" data-w="${(c.cost/maxCost*100).toFixed(1)}"><span>${fmt(c.cost)}</span></div></div>
      <div class="bar-val">${fmt(c.cost)}</div>
    </div>`).join('');
  requestAnimationFrame(() => chartEl.querySelectorAll('.bar-fill').forEach(b => b.style.width = b.dataset.w + '%'));

  // T√°bl√°zat
  const tbLabel = isNyugdijas ? '‚Äî TB j√°rul√©k (nyugd√≠jas: mentes)' : '‚Äî Munkav√°llal√≥ TB j√°rul√©k (18,5%)';
  const mbTbVal = mb.nemBiztositott ? null : (isNyugdijas ? 0 : -mb.tb);
  const mbMunkaltVal = mb.nemBiztositott ? null : mb.munkaltAdo;
  const jarulekAlapSorTabla = m.jarulekAlapMinAlkalmaz
    ? [{ l: '‚ö†Ô∏è J√°rul√©kalap min. (30% = ' + fmt(JARULEK_ALAP_MIN) + ')', m: m.jarulek_alap, mb: null, ek: null, e: null, info: true }]
    : [];
  const megbizasNemBiztInfo = mb.nemBiztositott
    ? [{ l: '‚ÑπÔ∏è Megb√≠z√°s: nem biztos√≠tott (d√≠j < ' + fmt(JARULEK_ALAP_MIN) + ')', m: null, mb: null, ek: null, e: null, info2: true }]
    : [];
  const eTabla = efoNemLehetseges ? null : e;

  // T√°bl√°zat fejl√©c ‚Äî EKHO oszlop dinamikusan
  const ekhoThEl = document.getElementById('ekhoColHeader');
  if (ekhoAktiv && !ekhoThEl) {
    const th = document.createElement('th');
    th.id = 'ekhoColHeader';
    th.style.textAlign = 'right';
    th.textContent = 'EKHO';
    document.getElementById('efoColHeader').before(th);
  } else if (!ekhoAktiv && ekhoThEl) {
    ekhoThEl.remove();
  }

  const tableRows = [
    { l: 'Brutt√≥ / d√≠j / kifizetett √∂sszeg',   m: m.brutto,      mb: mb.brutto,      ek: ekho?.brutto,       e: eTabla ? eTabla.netto : null },
    ...jarulekAlapSorTabla,
    ...megbizasNemBiztInfo,
    { l: '‚Äî Munkav√°llal√≥ SZJA',                m: -m.szja,       mb: -mb.szja,       ek: ekho ? 0 : null,    e: 0 },
    { l: tbLabel,                              m: isNyugdijas ? 0 : -m.tb, mb: mbTbVal, ek: ekho ? 0 : null, e: 0 },
    { l: '= Nett√≥ k√©zhez',                     m: m.netto,       mb: mb.netto,       ek: ekho?.netto,        e: eTabla ? e.netto : null, t: true },
    { l: '+ Munk√°ltat√≥i j√°rul√©k / k√∂zteher',   m: m.munkaltAdo,  mb: mbMunkaltVal,   ek: ekho?.ekhoOssz,     e: eTabla ? eTabla.kozteher : null },
    { l: '= Munk√°ltat√≥ √∂sszk√∂lts√©ge',          m: m.munkaltOssz, mb: mb.munkaltOssz, ek: ekho?.munkaltOssz,  e: eTabla ? eTabla.munkaltOssz : null, t: true },
    { l: 'Hat√©konys√°g (nett√≥ / √∂sszk√∂lts.)',   m: null, mb: null, ek: null, e: null, pct: true,
      mP: m.netto/m.munkaltOssz, mbP: mb.netto/mb.munkaltOssz,
      ekP: ekho ? ekho.netto/ekho.munkaltOssz : null,
      eP: eTabla ? e.netto/eTabla.munkaltOssz : null },
  ];

  document.getElementById('tableBody').innerHTML = tableRows.map(r => {
    const tc = r.t ? ' class="tr"' : r.info ? ' style="background:#FFF5F5"' : r.info2 ? ' style="background:#EBF8FF"' : '';
    const dc = r.t ? ' tr' : '';
    const f = v => v === null || v === undefined ? '<span style="color:#718096;font-style:italic;font-size:11px">‚Äî</span>' : v < 0 ? `<span style="color:var(--accent)">‚Äì ${fmt(Math.abs(v))}</span>` : v === 0 ? '‚Äî' : fmt(v);
    const ekhoTd = ekhoAktiv ? `<td class="num${dc}">${r.pct ? (r.ekP !== null ? (r.ekP*100).toFixed(1)+'%' : '‚Äî') : f(r.ek)}</td>` : '';
    if (r.pct) return `<tr${tc}><td class="rl${dc}">${r.l}</td><td class="num${dc}">${(r.mP*100).toFixed(1)}%</td><td class="num${dc}">${(r.mbP*100).toFixed(1)}%</td>${ekhoTd}<td class="num${dc}">${r.eP !== null ? (r.eP*100).toFixed(1)+'%' : '<span style="color:#C53030;font-size:11px">N/A</span>'}</td></tr>`;
    return `<tr${tc}><td class="rl${dc}">${r.l}</td><td class="num${dc}">${f(r.m)}</td><td class="num${dc}">${f(r.mb)}</td>${ekhoTd}<td class="num${dc}">${f(r.e)}</td></tr>`;
  }).join('');

  // √âves √∂sszes√≠t≈ë
  const evesEl = document.getElementById('eves-osszesito');
  const evesGrid = document.getElementById('eves-grid');
  const evesCosts = costs.map(c => {
    const evi = c.cost * 12;
    return `<div class="eves-card">
      <div class="eves-card-label">${c.label}</div>
      <div class="eves-card-val">${fmt(evi)}</div>
      <div class="eves-card-sub">${fmt(c.cost)}/h√≥ √ó 12</div>
    </div>`;
  });
  // Megtakar√≠t√°s az √©ves szinten
  const evesMegtakaritas = costs.length > 1 ? (costs[1].cost - costs[0].cost) * 12 : 0;
  evesGrid.innerHTML = evesCosts.join('') +
    `<div class="eves-card" style="background:#EBF8FF;border:1px solid #90CDF4;">
      <div class="eves-card-label">Megtakar√≠t√°s (1. vs 2.)</div>
      <div class="eves-card-val" style="color:#2B6CB0;">${fmt(evesMegtakaritas)}</div>
      <div class="eves-card-sub">${fmt(costs.length > 1 ? costs[1].cost - costs[0].cost : 0)}/h√≥ √ó 12</div>
    </div>`;
  evesEl.style.display = 'block';

  // Brutt√≥ / √≥rab√©r m√≥d t√°j√©koztat√≥
  const bruttoInfoEl = document.getElementById('bruttoInfoSav');
  if (bruttoInfo) {
    const orab√©rFejlec = kalkulatorIrany === 'orab√©r'
      ? (() => {
          const orab√©r = parseFloat(document.getElementById('orab√©rInput').value) || 0;
          const haviora = parseFloat(document.getElementById('havioraInput').value) || 174;
          const tipusLabel = orab√©rTipus === 'netto' ? 'nett√≥' : 'brutt√≥';
          return `<div style="font-family:'Fira Code',monospace;font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:#2B6CB0;flex-shrink:0;">√ìrab√©r ‚Üí Brutt√≥ ‚Üí Nett√≥</div>
          <div style="display:flex;gap:20px;flex-wrap:wrap;font-size:13px;">
            <span>${orab√©r.toLocaleString('hu-HU')} Ft/√≥ra (${tipusLabel}) √ó ${haviora} √≥ra = <strong style="font-family:'Fira Code',monospace">${fmt(bruttoInfo.brutto)}</strong> brutt√≥</span>
            <span style="color:var(--ink3)">‚Äì</span>
            <span>SZJA: <strong style="font-family:'Fira Code',monospace;color:#C53030">${fmt(bruttoInfo.szja)}</strong></span>
            ${bruttoInfo.tb > 0 ? `<span style="color:var(--ink3)">‚Äì</span><span>TB: <strong style="font-family:'Fira Code',monospace;color:#C53030">${fmt(bruttoInfo.tb)}</strong></span>` : ''}
            <span style="color:var(--ink3)">=</span>
            <span>Nett√≥ k√©zhez: <strong style="font-family:'Fira Code',monospace;color:#276749">${fmt(bruttoInfo.netto)}</strong></span>
          </div>`;
        })()
      : `<div style="font-family:'Fira Code',monospace;font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:#2B6CB0;flex-shrink:0;">Brutt√≥ ‚Üí Nett√≥ √°tv√°lt√°s</div>
        <div style="display:flex;gap:20px;flex-wrap:wrap;font-size:13px;">
          <span>Be√≠rt brutt√≥: <strong style="font-family:'Fira Code',monospace">${fmt(bruttoInfo.brutto)}</strong></span>
          <span style="color:var(--ink3)">‚Äì</span>
          <span>SZJA: <strong style="font-family:'Fira Code',monospace;color:#C53030">${fmt(bruttoInfo.szja)}</strong></span>
          ${bruttoInfo.tb > 0 ? `<span style="color:var(--ink3)">‚Äì</span><span>TB: <strong style="font-family:'Fira Code',monospace;color:#C53030">${fmt(bruttoInfo.tb)}</strong></span>` : ''}
          <span style="color:var(--ink3)">=</span>
          <span>Nett√≥ k√©zhez: <strong style="font-family:'Fira Code',monospace;color:#276749">${fmt(bruttoInfo.netto)}</strong></span>
        </div>`;
    bruttoInfoEl.innerHTML = `<div style="background:#EBF8FF;border:1.5px solid #90CDF4;border-radius:14px;padding:14px 20px;margin-bottom:18px;display:flex;align-items:center;flex-wrap:wrap;gap:16px;">${orab√©rFejlec}</div>`;
    bruttoInfoEl.style.display = 'block';
  } else {
    bruttoInfoEl.style.display = 'none';
  }

  document.getElementById('results').classList.add('visible');
  setTimeout(() => document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
}

// Init
updateEfoRef();
window.addEventListener('load', calculate);
</script>
</body>
</html>
